# Multi-workflow configurations for Railway / Render / local
# Copy env vars per service when creating multiple workers.
#
# §2.6 Parallel workers: Run Explorer and Exploiter together so completion (coverage) and quality
# (precision) improve in parallel. Both POST to the same API; Explorer fills registry gaps,
# Exploiter reinforces good prompts. See docs/WORKFLOW_EFFICIENCY_AND_REGISTRY_COMPLETION.md.
#
# Two dimensions:
#   1. Prompt choice: explorer (100% explore) | exploiter (100% exploit) | balanced (UI ratio).
#   2. Extraction focus: frame (per-frame / pure static only) | window (per-window blends only).
#   3. Optional: LOOP_STATIC_FOCUS = color | sound | both (when frame: grow only colors, only sounds, or both).
# Set LOOP_EXTRACTION_FOCUS so that 2 workers do frame and 1 does window.
#
# LOOP_WORKER_OFFSET_SECONDS: Stagger worker startup to reduce D1 contention. Set per service:
#   Explorer=0, Exploiter=5, Balanced=10, Balanced-2=15, etc. Prevents all workers from hitting
#   D1 simultaneously at loop start.
#
# Recommended: Explorer + Exploiter = frame (2 frame workers). Balanced = window (1 window worker).
# For a pure-colors frame worker set LOOP_STATIC_FOCUS=color; pure sounds also have the dedicated sound workflow.

workflows:
  explorer:
    description: "Frame-focused — 100% explore; per-frame extraction + static registry only; authentic names"
    env:
      API_BASE: https://motion.productions
      LOOP_EXPLOIT_RATIO_OVERRIDE: "0"
      LOOP_WORKFLOW_TYPE: "explorer"
      LOOP_EXTRACTION_FOCUS: "frame"
      LOOP_WORKER_OFFSET_SECONDS: "0"

  balanced:
    description: "Window-focused — uses webapp config (exploit/explore ratio); per-window extraction + dynamic + narrative"
    env:
      API_BASE: https://motion.productions
      LOOP_EXTRACTION_FOCUS: "window"
      LOOP_WORKER_OFFSET_SECONDS: "10"
      # LOOP_WORKFLOW_TYPE: "main"  # optional, for badge on site

  exploiter:
    description: "Frame-focused — 100% exploit; per-frame extraction + static registry only; authentic names"
    env:
      API_BASE: https://motion.productions
      LOOP_EXPLOIT_RATIO_OVERRIDE: "1"
      LOOP_WORKFLOW_TYPE: "exploiter"
      LOOP_EXTRACTION_FOCUS: "frame"
      LOOP_WORKER_OFFSET_SECONDS: "5"

  interpretation:
    description: "Interpretation only — no create/render; fills interpretation registry (D1) for main pipeline"
    # Start command from railway.toml (railway_start.py); this env selects interpret_loop.py
    env:
      RAILWAY_START_SCRIPT: interpret_loop
      API_BASE: https://motion.productions
      INTERPRET_DELAY_SECONDS: "10"

  # Pure sound discovery: no video. Generates procedural audio → extract → grow static_sound → sync.
  sound:
    description: "Sound-only — no create/render; pure sound extraction + growth; fills static_sound registry"
    # Start command from railway.toml (railway_start.py); this env selects sound_loop.py
    env:
      RAILWAY_START_SCRIPT: sound_loop
      API_BASE: https://motion.productions
      SOUND_LOOP_DELAY_SECONDS: "15"
      SOUND_LOOP_DURATION_SECONDS: "2.5"
      HEALTH_PORT: "8080"
